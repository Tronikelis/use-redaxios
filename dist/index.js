import{jsx as t}from"react/jsx-runtime";import{createContext as r,useContext as o,useState as a}from"react";import e from"redaxios";import{merge as i}from"merge-anything";import{dequal as n}from"dequal";import{useCustomCompareEffect as s}from"use-custom-compare";import c from"lru-cache";const d=r({options:{axios:e.defaults}});function u({options:r,children:o}){return t(d.Provider,Object.assign({value:{options:r}},{children:o}),void 0)}const m=new c({max:500,maxAge:36e5});function p(t,r={},c){var u;const{options:p}=o(d),[l,f]=a(null!==(u=m.get(JSON.stringify(i(p,r))+t+"get"))&&void 0!==u?u:void 0),[g,v]=a(!!c),[y,x]=a(void 0),h=async(o,a,s)=>{var c,d;v(!0);const u=i(p,r),l=m.get(JSON.stringify(u)+t+a);l&&(f(l),v(!1));u.axios=(null===(c=u.interceptors)||void 0===c?void 0:c.request)?await u.interceptors.request(null!==(d=u.axios)&&void 0!==d?d:{}):u.axios;const[g,y]=await async function(t){try{return[await t,!1]}catch(t){return[t,!0]}}(e({url:t+a,method:o,data:s,...u.axios}));return y?(x(g),h=g,u.onError&&u.onError(h),void v(!1)):(n(g.data,l)||(m.set(JSON.stringify(u)+t+a,g.data),f(g.data)),x(void 0),(t=>{u.onSuccess&&u.onSuccess(t)})(g.data),v(!1),g.data);var h};s((()=>{Array.isArray(c)&&h("get","")}),[...null!=c?c:[]],n);return{data:l,loading:g,error:y,get:async(t="")=>h("get",t),post:async(t="",r)=>h("post",t,r),del:async(t="")=>h("delete",t),put:async(t="",r)=>h("put",t,r),patch:async(t="",r)=>h("patch",t,r)}}export{u as RedaxiosProvider,p as useRedaxios};
