import{jsx as t}from"react/jsx-runtime";import{createContext as r,useContext as o,useState as e}from"react";import a from"redaxios";import{merge as i}from"merge-anything";import{dequal as n}from"dequal";import{useCustomCompareEffect as s}from"use-custom-compare";import u from"quick-lru";import l from"fast-json-stable-stringify";const c=r({options:{axios:a.defaults}});function d({options:r,children:o}){return t(c.Provider,Object.assign({value:{options:r}},{children:o}),void 0)}const p=({...t})=>((t,r=0)=>{let o=3735928559^r,e=1103547991^r;for(let r,a=0;a<t.length;a++)r=t.charCodeAt(a),o=Math.imul(o^r,2654435761),e=Math.imul(e^r,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(e^e>>>13,3266489909),e=Math.imul(e^e>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&e)+(o>>>0)})(l({...t})),m=new u({maxSize:500,maxAge:36e5});function v(t,r={},u){var l;const{options:d}=o(c),[v,y]=e(null!==(l=m.get(p({url:t,relativeUrl:"",type:"get",options:r,deps:u})))&&void 0!==l?l:void 0),[f,h]=e(!!u),[g,x]=e(!!u),[M,w]=e(void 0),b=async(o,e,s)=>{var l;x(!0);const c=m.get(p({url:t,relativeUrl:e,type:o,body:s,options:r,deps:u}));c?(y(c),h(!1)):h(!0);const v=i(d,r);v.axios=await(t=>{var r;return(null===(r=v.interceptors)||void 0===r?void 0:r.request)?v.interceptors.request(t):t})(null!==(l=v.axios)&&void 0!==l?l:{});const[f,g]=await async function(t){try{return[await t,!1]}catch(t){return[t,!0]}}(a({url:t+e,method:o,data:s,...v.axios}));return g?(w(f),M=f,v.onError&&v.onError(M),x(!1),void h(!1)):(f.data=await(t=>{var r;return(null===(r=v.interceptors)||void 0===r?void 0:r.response)?v.interceptors.response(t):t})(f.data),n(f.data,c)||(m.set(p({url:t,relativeUrl:e,type:o,body:s,options:r,deps:u}),f.data),y(f.data)),w(void 0),(t=>{v.onSuccess&&v.onSuccess(t)})(f.data),x(!1),h(!1),f.data);var M};s((()=>{Array.isArray(u)&&b("get","")}),[...null!=u?u:[]],n);return{data:v,error:M,fetching:g,loading:f,get:async(t="")=>b("get",t),post:async(t="",r)=>b("post",t,r),del:async(t="")=>b("delete",t),put:async(t="",r)=>b("put",t,r),patch:async(t="",r)=>b("patch",t,r)}}export{d as RedaxiosProvider,v as useRedaxios};
