import{jsx as o}from"react/jsx-runtime";import{createContext as t,useContext as r,useState as a}from"react";import n from"redaxios";import{merge as e}from"merge-anything";import{dequal as i}from"dequal";import{useCustomCompareEffect as s}from"use-custom-compare";import u from"lru-cache";const c=t({options:{axios:n.defaults}});function l({options:t,children:r}){return o(c.Provider,Object.assign({value:{options:t}},{children:r}),void 0)}const d=new u({max:500,maxAge:36e5});function m(o,t={},u){var l,m;const{options:p}=r(c),[v,x]=a(null!==(m=d.get(o+(null===(l=e(p,t).axios)||void 0===l?void 0:l.url)+"get"))&&void 0!==m?m:null),[f,g]=a(!!u),[y,h]=a(null),w=async(r,a,s)=>{var u,c,l,m;g(!0);const v=e(p,t),f=d.get(o+a+(null===(u=v.axios)||void 0===u?void 0:u.url)+r);f&&(x(f),g(!1));v.axios=(null===(c=v.interceptors)||void 0===c?void 0:c.request)?await v.interceptors.request(null!==(l=v.axios)&&void 0!==l?l:{}):v.axios;const[y,w]=await async function(o){try{return[await o,!1]}catch(o){return[o,!0]}}(n({url:o+a,method:r,data:s,...v.axios}));return w?(h(y),q=y,v.onError&&v.onError(q),void g(!1)):(i(y.data,f)||(d.set(o+a+(null===(m=v.axios)||void 0===m?void 0:m.url)+r,y.data),x(y.data)),h(null),(o=>{v.onSuccess&&v.onSuccess(o)})(y.data),g(!1),y.data);var q};s((()=>{Array.isArray(u)&&w("get","")}),[...null!=u?u:[]],i);return{data:v,loading:f,error:y,get:async(o="")=>w("get",o),post:async(o="",t)=>w("post",o,t),del:async(o="")=>w("delete",o),put:async(o="",t)=>w("put",o,t),patch:async(o="",t)=>w("patch",o,t)}}export{l as RedaxiosProvider,m as useRedaxios};
