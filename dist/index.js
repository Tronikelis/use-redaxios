import{jsx as t}from"react/jsx-runtime";import{createContext as o,useContext as r,useState as e}from"react";import a from"redaxios";import{merge as i}from"merge-anything";import{dequal as n}from"dequal";import{useCustomCompareEffect as s}from"use-custom-compare";import l from"quick-lru";import u from"fast-json-stable-stringify";const c=o({options:{axios:a.defaults}});function d({options:o,children:r}){return t(c.Provider,Object.assign({value:{options:o}},{children:r}),void 0)}const p=({...t})=>((t,o=0)=>{let r=3735928559^o,e=1103547991^o;for(let o,a=0;a<t.length;a++)o=t.charCodeAt(a),r=Math.imul(r^o,2654435761),e=Math.imul(e^o,1597334677);return r=Math.imul(r^r>>>16,2246822507)^Math.imul(e^e>>>13,3266489909),e=Math.imul(e^e>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),4294967296*(2097151&e)+(r>>>0)})(u({...t})),m=new l({maxSize:500,maxAge:36e5});function v(t,o={},l){var u;const{options:d}=r(c),[v,y]=e(null!==(u=m.get(p({url:t,relativeUrl:"",type:"get",options:o,deps:l})))&&void 0!==u?u:void 0),[f,h]=e(!!l),[g,x]=e(void 0),M=async(r,e,s)=>{var u,c;const v=m.get(p({url:t,relativeUrl:e,type:r,body:s,options:o,deps:l}));v?(y(v),h(!1)):h(!0);const f=i(d,o);f.axios=(null===(u=f.interceptors)||void 0===u?void 0:u.request)?await f.interceptors.request(null!==(c=f.axios)&&void 0!==c?c:{}):f.axios;const[g,M]=await async function(t){try{return[await t,!1]}catch(t){return[t,!0]}}(a({url:t+e,method:r,data:s,...f.axios}));return M?(x(g),b=g,f.onError&&f.onError(b),void h(!1)):(n(g.data,v)||(m.set(p({url:t,relativeUrl:e,type:r,body:s,options:o,deps:l}),g.data),y(g.data)),x(void 0),(t=>{f.onSuccess&&f.onSuccess(t)})(g.data),h(!1),g.data);var b};s((()=>{Array.isArray(l)&&M("get","")}),[...null!=l?l:[]],n);return{data:v,loading:f,error:g,get:async(t="")=>M("get",t),post:async(t="",o)=>M("post",t,o),del:async(t="")=>M("delete",t),put:async(t="",o)=>M("put",t,o),patch:async(t="",o)=>M("patch",t,o)}}export{d as RedaxiosProvider,v as useRedaxios};
