import{jsx as t}from"react/jsx-runtime";import{createContext as r,useContext as o,useState as e,useEffect as a,useCallback as n}from"react";import i from"redaxios";import{merge as s}from"merge-anything";import c from"fast-json-stable-stringify";import l from"tiny-lru";const u=r({options:{axios:i.defaults}});function d({options:r,children:o}){return t(u.Provider,Object.assign({value:{options:r}},{children:o}),void 0)}const p=({...t})=>((t,r=0)=>{let o=3735928559^r,e=1103547991^r;for(let r,a=0;a<t.length;a++)r=t.charCodeAt(a),o=Math.imul(o^r,2654435761),e=Math.imul(e^r,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(e^e>>>13,3266489909),e=Math.imul(e^e>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&e)+(o>>>0)})(c({...t})).toString(),m=l(500,36e5);function v(t,r={},l){const{options:d}=o(u),[v,y]=e(m.get(p({url:t,relativeUrl:"",type:"get",options:r,deps:l}))),[h,f]=e(!!l),[g,x]=e(!!l),[M,b]=e(void 0),w=async(o,e,a)=>{var n;x(!0);const u=m.get(p({url:t,relativeUrl:e,type:o,body:a,options:r,deps:l}));u?(y(u),f(!1)):f(!0);const v=s(d,r);v.axios=await(t=>{var r;return(null===(r=v.interceptors)||void 0===r?void 0:r.request)?v.interceptors.request(t):t})(null!==(n=v.axios)&&void 0!==n?n:{});const[h,g]=await async function(t){try{return[await t,!1]}catch(t){return[t,!0]}}(i({url:t+e,method:o,data:a,...v.axios}));return g?(b(h),M=h,v.onError&&v.onError(M),x(!1),void f(!1)):(h.data=await(t=>{var r;return(null===(r=v.interceptors)||void 0===r?void 0:r.response)?v.interceptors.response(t):t})(h.data),w=h.data,j=u,c(w)!==c(j)&&(m.set(p({url:t,relativeUrl:e,type:o,body:a,options:r,deps:l}),h.data),y(h.data)),b(void 0),(t=>{v.onSuccess&&v.onSuccess(t)})(h.data),x(!1),f(!1),h.data);var M,w,j};a((()=>{Array.isArray(l)&&w("get","")}),[c(l)]);const j=n((async(t="")=>w("get",t)),[t]),A=n((async(t="",r)=>w("post",t,r)),[t]),S=n((async(t="")=>w("delete",t)),[t]),U=n((async(t="",r)=>w("put",t,r)),[t]),q=n((async(t="",r)=>w("patch",t,r)),[t]);return{data:v,error:M,fetching:g,loading:h,get:j,post:A,del:S,put:U,patch:q}}export{d as RedaxiosProvider,v as default,v as useRedaxios};
