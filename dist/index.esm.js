import{jsx as t}from"react/jsx-runtime";import{createContext as r,useContext as o,useState as e,useCallback as a}from"react";import i from"redaxios";import{merge as n}from"merge-anything";import{dequal as s}from"dequal";import{useCustomCompareEffect as c}from"use-custom-compare";import u from"tiny-lru";import l from"fast-json-stable-stringify";const p=r({options:{axios:i.defaults}});function d({options:r,children:o}){return t(p.Provider,Object.assign({value:{options:r}},{children:o}),void 0)}const m=({...t})=>((t,r=0)=>{let o=3735928559^r,e=1103547991^r;for(let r,a=0;a<t.length;a++)r=t.charCodeAt(a),o=Math.imul(o^r,2654435761),e=Math.imul(e^r,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(e^e>>>13,3266489909),e=Math.imul(e^e>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&e)+(o>>>0)})(l({...t})).toString(),v=u(500,36e5);function y(t,r={},u){const{options:l}=o(p),[d,y]=e(v.get(m({url:t,relativeUrl:"",type:"get",options:r,deps:u}))),[f,h]=e(!!u),[g,x]=e(!!u),[M,b]=e(void 0),w=async(o,e,a)=>{var c;x(!0);const p=v.get(m({url:t,relativeUrl:e,type:o,body:a,options:r,deps:u}));p?(y(p),h(!1)):h(!0);const d=n(l,r);d.axios=await(t=>{var r;return(null===(r=d.interceptors)||void 0===r?void 0:r.request)?d.interceptors.request(t):t})(null!==(c=d.axios)&&void 0!==c?c:{});const[f,g]=await async function(t){try{return[await t,!1]}catch(t){return[t,!0]}}(i({url:t+e,method:o,data:a,...d.axios}));return g?(b(f),M=f,d.onError&&d.onError(M),x(!1),void h(!1)):(f.data=await(t=>{var r;return(null===(r=d.interceptors)||void 0===r?void 0:r.response)?d.interceptors.response(t):t})(f.data),s(f.data,p)||(v.set(m({url:t,relativeUrl:e,type:o,body:a,options:r,deps:u}),f.data),y(f.data)),b(void 0),(t=>{d.onSuccess&&d.onSuccess(t)})(f.data),x(!1),h(!1),f.data);var M};c((()=>{Array.isArray(u)&&w("get","")}),[...null!=u?u:[]],s);const j=a((async(t="")=>w("get",t)),[t]),q=a((async(t="",r)=>w("post",t,r)),[t]),A=a((async(t="")=>w("delete",t)),[t]),S=a((async(t="",r)=>w("put",t,r)),[t]),U=a((async(t="",r)=>w("patch",t,r)),[t]);return{data:d,error:M,fetching:g,loading:f,get:j,post:q,del:A,put:S,patch:U}}export{d as RedaxiosProvider,y as useRedaxios};
