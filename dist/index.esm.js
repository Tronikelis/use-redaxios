import{jsx as t}from"react/jsx-runtime";import{createContext as r,useContext as o,useState as e,useEffect as a,useCallback as i}from"react";import n from"redaxios";import{merge as s}from"merge-anything";import{dequal as c}from"dequal";import l from"fast-json-stable-stringify";import u from"tiny-lru";const d=r({options:{axios:n.defaults}});function p({options:r,children:o}){return t(d.Provider,Object.assign({value:{options:r}},{children:o}),void 0)}const m=({...t})=>((t,r=0)=>{let o=3735928559^r,e=1103547991^r;for(let r,a=0;a<t.length;a++)r=t.charCodeAt(a),o=Math.imul(o^r,2654435761),e=Math.imul(e^r,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(e^e>>>13,3266489909),e=Math.imul(e^e>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&e)+(o>>>0)})(l({...t})).toString(),v=u(500,36e5);function y(t,r={},u){const{options:p}=o(d),[y,h]=e(v.get(m({url:t,relativeUrl:"",type:"get",options:r,deps:u}))),[f,g]=e(!!u),[x,M]=e(!!u),[b,w]=e(void 0),j=async(o,e,a)=>{var i;M(!0);const l=v.get(m({url:t,relativeUrl:e,type:o,body:a,options:r,deps:u}));l?(h(l),g(!1)):g(!0);const d=s(p,r);d.axios=await(t=>{var r;return(null===(r=d.interceptors)||void 0===r?void 0:r.request)?d.interceptors.request(t):t})(null!==(i=d.axios)&&void 0!==i?i:{});const[y,f]=await async function(t){try{return[await t,!1]}catch(t){return[t,!0]}}(n({url:t+e,method:o,data:a,...d.axios}));return f?(w(y),x=y,d.onError&&d.onError(x),M(!1),void g(!1)):(y.data=await(t=>{var r;return(null===(r=d.interceptors)||void 0===r?void 0:r.response)?d.interceptors.response(t):t})(y.data),c(y.data,l)||(v.set(m({url:t,relativeUrl:e,type:o,body:a,options:r,deps:u}),y.data),h(y.data)),w(void 0),(t=>{d.onSuccess&&d.onSuccess(t)})(y.data),M(!1),g(!1),y.data);var x};a((()=>{Array.isArray(u)&&j("get","")}),[l(u)]);const q=i((async(t="")=>j("get",t)),[t]),A=i((async(t="",r)=>j("post",t,r)),[t]),S=i((async(t="")=>j("delete",t)),[t]),U=i((async(t="",r)=>j("put",t,r)),[t]),E=i((async(t="",r)=>j("patch",t,r)),[t]);return{data:y,error:b,fetching:x,loading:f,get:q,post:A,del:S,put:U,patch:E}}export{p as RedaxiosProvider,y as useRedaxios};
