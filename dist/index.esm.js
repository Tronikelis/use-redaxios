import{jsx as t}from"react/jsx-runtime";import{createContext as r,useContext as o,useState as e,useCallback as a}from"react";import i from"redaxios";import{merge as n}from"merge-anything";import{dequal as s}from"dequal";import{useCustomCompareEffect as u}from"use-custom-compare";import c from"quick-lru";import l from"fast-json-stable-stringify";const d=r({options:{axios:i.defaults}});function p({options:r,children:o}){return t(d.Provider,Object.assign({value:{options:r}},{children:o}),void 0)}const m=({...t})=>((t,r=0)=>{let o=3735928559^r,e=1103547991^r;for(let r,a=0;a<t.length;a++)r=t.charCodeAt(a),o=Math.imul(o^r,2654435761),e=Math.imul(e^r,1597334677);return o=Math.imul(o^o>>>16,2246822507)^Math.imul(e^e>>>13,3266489909),e=Math.imul(e^e>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&e)+(o>>>0)})(l({...t})),v=new c({maxSize:500,maxAge:36e5});function y(t,r={},c){var l;const{options:p}=o(d),[y,f]=e(null!==(l=v.get(m({url:t,relativeUrl:"",type:"get",options:r,deps:c})))&&void 0!==l?l:void 0),[h,g]=e(!!c),[x,M]=e(!!c),[w,b]=e(void 0),q=async(o,e,a)=>{var u;M(!0);const l=v.get(m({url:t,relativeUrl:e,type:o,body:a,options:r,deps:c}));l?(f(l),g(!1)):g(!0);const d=n(p,r);d.axios=await(t=>{var r;return(null===(r=d.interceptors)||void 0===r?void 0:r.request)?d.interceptors.request(t):t})(null!==(u=d.axios)&&void 0!==u?u:{});const[y,h]=await async function(t){try{return[await t,!1]}catch(t){return[t,!0]}}(i({url:t+e,method:o,data:a,...d.axios}));return h?(b(y),x=y,d.onError&&d.onError(x),M(!1),void g(!1)):(y.data=await(t=>{var r;return(null===(r=d.interceptors)||void 0===r?void 0:r.response)?d.interceptors.response(t):t})(y.data),s(y.data,l)||(v.set(m({url:t,relativeUrl:e,type:o,body:a,options:r,deps:c}),y.data),f(y.data)),b(void 0),(t=>{d.onSuccess&&d.onSuccess(t)})(y.data),M(!1),g(!1),y.data);var x};u((()=>{Array.isArray(c)&&q("get","")}),[...null!=c?c:[]],s);const A=a((async(t="")=>q("get",t)),[t]),j=a((async(t="",r)=>q("post",t,r)),[t]),S=a((async(t="")=>q("delete",t)),[t]),U=a((async(t="",r)=>q("put",t,r)),[t]),E=a((async(t="",r)=>q("patch",t,r)),[t]);return{data:y,error:w,fetching:x,loading:h,get:A,post:j,del:S,put:U,patch:E}}export{p as RedaxiosProvider,y as useRedaxios};
